<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIKIDS Attendance Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Kantumruy+Pro:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Kantumruy Pro', sans-serif; background-color: #f1f5f9; }
        .active-class { background-color: #1e40af !important; color: white !important; border-left: 5px solid #fbbf24 !important; }
        /* á”á“áŸ’ááŸ‚á˜á–ááŸŒá–áŸá›á…á»á…á›á¾á‡á˜áŸ’ášá¾áŸá“á¸á˜á½á™áŸ— */
        .radio-p:checked + span { color: #10b981; font-weight: bold; } /* á˜á€ - á–ááŸŒá”áŸƒáá„ */
        .radio-l:checked + span { color: #f59e0b; font-weight: bold; } /* á…áŸ’á”á¶á”áŸ‹ - á–ááŸŒá‘á¹á€á€áŸ’ášá¼á… */
        .radio-a:checked + span { color: #ef4444; font-weight: bold; } /* áˆá”áŸ‹ - á–ááŸŒá€áŸ’ášá á˜ */
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>

    <nav class="bg-blue-900 text-white p-4 sticky top-0 z-50 shadow-md no-print">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-yellow-400 text-blue-900 font-black px-2 py-1 rounded">MIKIDS</div>
                <h1 class="font-bold text-lg tracking-tight">Attendance System</h1>
            </div>
            <div class="flex gap-2">
                <select id="sel-month" onchange="refreshTable()" class="bg-blue-800 text-xs border-none rounded px-2 outline-none cursor-pointer">
                    <option value="January">January</option><option value="February">February</option>
                    <option value="March">March</option><option value="April">April</option>
                    <option value="May">May</option><option value="June">June</option>
                    <option value="July">July</option><option value="August">August</option>
                    <option value="September">September</option><option value="October">October</option>
                    <option value="November">November</option><option value="December">December</option>
                </select>
                <select id="sel-year" onchange="refreshTable()" class="bg-blue-800 text-xs border-none rounded px-2 outline-none cursor-pointer">
                    <option value="2025">2025</option>
                    <option value="2026" selected>2026</option>
                </select>
                <button onclick="saveLocal()" class="bg-emerald-500 hover:bg-emerald-600 px-4 py-1.5 rounded text-xs font-bold transition">Save Data</button>
                <button onclick="sendToTelegram()" class="bg-sky-500 hover:bg-sky-600 px-4 py-1.5 rounded text-xs font-bold transition">Send Telegram</button>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto flex flex-col md:flex-row gap-6 p-6">
        
        <aside class="w-full md:w-80 bg-white rounded-xl shadow-sm border border-slate-200 p-4 h-[85vh] overflow-y-auto no-print">
            <h2 class="text-slate-400 text-[10px] font-bold uppercase mb-4 tracking-widest italic">á”á‰áŸ’á‡á¸ááŸ’á“á¶á€áŸ‹ášáŸ€á“ / Classes</h2>
            <div id="class-list" class="flex flex-col gap-1"></div>
            
            <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-100">
                <label class="text-[9px] font-bold text-blue-600 uppercase">Telegram Config</label>
                <input id="tg-id" type="text" value="-1005090259958" class="w-full text-xs p-2 border rounded mt-1 mb-2 outline-none focus:ring-1 ring-blue-300">
                <input id="tg-token" type="password" value="8501623225:AAGu-F_GHSQ-dLBrEME7eidOpW2yDf3qvXw" class="w-full text-xs p-2 border rounded outline-none focus:ring-1 ring-blue-300">
            </div>
        </aside>

        <main class="flex-1 bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-6 border-b flex justify-between items-center bg-slate-50/50">
                <div>
                    <h2 id="display-class-name" class="text-2xl font-bold text-slate-800">Select class</h2>
                    <p id="display-date" class="text-slate-500 text-sm font-medium"></p>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead>
                        <tr class="bg-slate-100/50 text-slate-500 text-[10px] font-bold uppercase border-b">
                            <th class="p-4 w-12 text-center">No.</th>
                            <th class="p-4 w-20">ID</th>
                            <th class="p-4">Student Name</th>
                            <th class="p-4 w-16 text-center">Sex</th>
                            <th class="p-4 text-center">Status (P / L / A)</th>
                        </tr>
                    </thead>
                    <tbody id="student-table-body" class="divide-y divide-slate-100 text-sm"></tbody>
                </table>
            </div>
            <div id="empty-msg" class="p-20 text-center text-slate-300 font-medium italic">Please select a class from the sidebar.</div>
        </main>
    </div>

    <script>
        const allData = [
            { className: "Nursery", students: [{id:"148", n:"á”áŸášáŸ‰áŸáŸ á˜áŸ‰áŸƒáƒá¾áŸ", g:"M"},{id:"144", n:"á áŸá„ áŸá“áŸ’áá·á—á¶á–", g:"M"},{id:"157", n:"áŠá½á„ áŸá»á˜áŸá’á¶", g:"M"},{id:"183", n:"áá»á„ á áŸ’áœá»á„á˜áŸ‰áŸá„", g:"M"},{id:"158", n:"á–á“áŸ’á›á€ áœá·ášáŸá·á‘áŸ’á’", g:"M"},{id:"172", n:"ášáá“á¶ áŸáŸ€áœá›á·", g:"F"},{id:"180", n:"ášáŸ‰á¶ááŸ‹ á–áŸá‡áŸ’ášá˜ášá€á", g:"F"},{id:"178", n:"á›á¸áœá‘áŸ’á’á¸ á‡á»áá·á˜á¶", g:"F"},{id:"184", n:"á á¼ á›á¸á—á¸á„", g:"-"},{id:"174", n:"áœá·á…áŸ’á†á·á€á¶ á˜á»á“áŸ’á“á¸á‘áŸá–á¸", g:"F"},{id:"185", n:"á™á¹á˜ á–á»á‘áŸ’á’á·áœá„áŸ’áŸ", g:"M"},{id:"171", n:"áŸá»á„ áŸá·ášá¸á”á»ááŸ’áš", g:"M"},{id:"147", n:"áŸá»á—áŸá€áŸ’áš áœá¸ášá”á»ááŸ’áš", g:"M"},{id:"150", n:"áœáŸ‰áŸá á“á¸ášá¸áá¶", g:"F"},{id:"166", n:"á›á¸áá¶ á á»á„áŸáŸá€áŸ’á€á·á¢á’á·á—á¼", g:"M"}] },
            { className: "á˜ááŸ’ááŸá™áŸ’á™á‘á¶á”", students: [{id:"147", n:"áŸá»á—á€áŸ’ášâ€‹â€‹ áœá¸ášá”á»ááŸ’áš", g:"M"},{id:"166", n:"á›á¸áá¶ ášáŸááŸ’á“á á»á„áŸáŸá€áŸ’á€á·á¢á’á·á—á¼", g:"M"},{id:"160", n:"áá¼ áŸá·á‘áŸ’á’á¸á™á¼áá¶", g:"F"},{id:"175", n:"á áŸá„ á‡áŸášá˜áŸ‰á¸á„", g:"F"},{id:"-", n:"áœáŸ‰áŸá á“á¸ášá¸áá¶", g:"F"}] },
            { className: "á˜ááŸ’ááŸá™áŸ’á™á€ááŸ’áá¶á› áŸ¡", students: [{id:"64", n:"áƒá»á“ á‘áŸá–á„áŸ’áŸ", g:"M"},{id:"121", n:"á“á¿á“ áœáŒáŸ’áá“á¶", g:"M"},{id:"128", n:"á–á·áŸá·á‘áŸ’á¢ á…áŸá“áŸ’á‘áœáŒáŸ’áƒ", g:"M"},{id:"141", n:"á áŸá„ áŸá¶á‡á¸á„", g:"F"},{id:"132", n:"áŸá» á”á‰áŸ’á‰á¶ á˜á»á“á·ášá¶á‡", g:"M"},{id:"67", n:"áˆá¿á“ á”áŸŠá»á“á’á¿á“á–á»á‘áŸ’á’á·", g:"M"},{id:"173", n:"áŸá¶á“áŸ’á á›á¸á”áŸ‰áŸá„", g:"M"},{id:"163", n:"á¢áŸá„ á›á¸á†áŸá„", g:"M"},{id:"179", n:"á…á“áŸ’áá¶ áœáŒáŸ’áá“á¶", g:"M"},{id:"162", n:"á™áŸ‰á¶á“áŸ‹ áŸá»áá¡áŸá„", g:"M"}] },
            { className: "á˜ááŸ’ááŸá™áŸ’á™á€ááŸ’áá¶á› áŸ¢", students: [{id:"139", n:"á áŸŠáºá˜ á˜áŸ‰á¸á¢áŸŠá·", g:"M"},{id:"146", n:"á›á“ áœáŸáŸáŸ’áŸá—á¼", g:"M"},{id:"102", n:"áŸáŸ†áá¶á„ áœá¸ášáŸˆá”á»ááŸ’áš", g:"M"},{id:"67", n:"áˆá¿á“ á”áŸŠá»á“á’á¿á“á–á»á‘áŸ’á’á·", g:"M"},{id:"181", n:"áˆá“ á…áŸáŸáŸ’áŠá¶", g:"M"},{id:"87", n:"á¢áŸŠá»áŸ† ášáá“á¶áŸá·á‘áŸ’á’á¸á€á¶áš", g:"F"},{id:"113", n:"áŸáŸŠá¸á˜ áŸá·á‘áŸ’á’á¸á€á¶áš", g:"F"},{id:"164", n:"á¢áŸŠá¼áŸá»áœááŸ’á áœáŸá á¶áŸ", g:"M"},{id:"177", n:"áœá¶áŸá“á¶ á–áŸá‡áŸ’ášáŸá»á˜áŸ‰á¶á›á¸", g:"F"},{id:"165", n:"á›á¹á˜ á›á¸á˜áŸ‰áŸá„á‚áŸá„áŸ’á‚", g:"M"}] },
            { className: "á˜ááŸ’ááŸá™áŸ’á™ááŸ’á–áŸáŸ‹ áŸ¡", students: [{id:"29", n:"áá¶á“áŸ‹ á˜á»á“á¸áœá›áŸ’á›á—á¶", g:"F"},{id:"101", n:"áˆá»áŸ† áœá¸ášáŸ‹áŸá·á‘áŸ’á’", g:"M"},{id:"65", n:"á“á·á áŸá»á’á¶ášáŸ‰á¶", g:"M"},{id:"78", n:"á“á¸ á›á¸á‡á¸á„", g:"F"},{id:"117", n:"á áŸŠá»á“ ášá¶ááŸ’áá‡áŸááŸáŸ’áŠá¶", g:"M"},{id:"47", n:"á”á»ááŸ’áá‡áŸ á‡áŸá“á“á¸", g:"F"},{id:"14", n:"áƒá»á“ á‘áŸá–á¸", g:"F"},{id:"62", n:"ášá·á‘áŸ’á’á¸ á–á·áŸáŸ’áŸá»ááŸá»á€áŸ’ášá¹á", g:"M"},{id:"49", n:"á„á·á“ á‘áŸ€á“áœá·á“", g:"M"},{id:"107", n:"áŸá»á—á€áŸ’ášáŸ áœášáŸˆáŸá·á‘áŸ’á’", g:"M"},{id:"170", n:"á¢á»á›áœá¿á“ áŠá¶áœá¸á“", g:"F"},{id:"137", n:"áŸá¿á“ á…á¶á“áŸ‹áŸá»á˜áŸá’á¶", g:"F"},{id:"1", n:"á”áŸŠá»á“ášá¸á“ ááŸá˜ášá¶", g:"M"}] },
            { className: "á˜ááŸ’ááŸá™áŸ’á™ááŸ’á–áŸáŸ‹ áŸ¢", students: [{id:"54", n:"á™á“áŸ‹ á›á¸á áŸá„", g:"M"},{id:"75", n:"áœá·á“ á”á‰áŸ’á‰á¶áœáŸá“áŸ’á", g:"M"},{id:"90", n:"áŸá¼ ášáŸáŸ’á˜á¸á–á“á·áá¶", g:"F"},{id:"50", n:"áŸá¼á™ ášá€áŸ’áŸá¶", g:"M"},{id:"0072", n:"á¢áŸŠá¼ áŸá»áá¢á¶á˜á¸", g:"F"},{id:"137", n:"áŸá¿á“ á…á¶á“áŸ‹áŸá»á˜áŸá’á¶", g:"F"},{id:"176", n:"á”áŸ‰á¹á˜ á˜áŸ‰á¸á‡á¼", g:"F"},{id:"85", n:"áŸáŸášá¸ á…á“áŸ’á‘áœáŒáŸ’áá“á¶", g:"M"},{id:"161", n:"á›á¸á˜ á áŸŠá¸á”áŸ‰", g:"M"},{id:"55", n:"á¢áŸŠá¶ á‡á¸á„á áŸáš", g:"F"},{id:"0079", n:"á˜á·ááŸ’á á˜áŸ‰áŸá„á áŸá„", g:"M"},{id:"74", n:"á…á¶á“áŸ‹á“á¸ áŸáŸŠá¼áŸá¶á“áŸ‹áá¶", g:"F"}] },
            { className: "ááŸ’á“á¶á€áŸ‹á‘á¸ áŸ¡ (á–áŸ’ášá¹á€)", students: [{id:"75", n:"á†á“ áœá·ášáŸˆáŸá·á‘áŸ’á’", g:"M"},{id:"47", n:"á‡á¶á¡á·á… á€á¼á›á¸á“", g:"M"},{id:"92", n:"áŸá»á”á‰áŸ’á‰á¶ áŸáŸ„á˜áŸ‰á¶", g:"F"},{id:"83", n:"á—áºá“ áá·ášá¶á™á»", g:"M"},{id:"69", n:"á›á¸ á†á¶á™áˆáŸá“", g:"M"},{id:"77", n:"áœá»áŒáŸ’áá¸ áŠá¶áœá¸á€á¶", g:"F"},{id:"93", n:"á¢áŸŠá¹á˜ ášáŸ„á…á“á¶", g:"F"},{id:"72", n:"áœá„áŸ’áŸ áŠá¶ášáŸ‰á¶áœá¸á“", g:"M"},{id:"95", n:"á…á¶áœ áœá·á“á á¶áœ", g:"M"},{id:"80", n:"á„á½á“ á”á‰áŸ’á‰á¶á–á»á‘áŸ’á’á·áŸáŸá€áŸ’áá·", g:"M"}] },
            { className: "ááŸ’á“á¶á€áŸ‹á‘á¸ áŸ¡ (á›áŸ’á„á¶á…)", students: [{id:"88", n:"á…áŸ†ášá¾á“ á…á“áŸ’á‘á§ááŸ’áá˜", g:"M"},{id:"91", n:"á”áŸŠá¼ áŸá¶á’á»á€á¶áš", g:"F"},{id:"82", n:"áŸáŸá“ á™áŸ‰á¶áŸáŸ’á˜á¸á“áá¶", g:"F"},{id:"85", n:"áŠá“ áŸá»á—áŸááŸ’áŒá˜áŸ‰á¼á“á¸á€á¶", g:"F"},{id:"78", n:"áŸáŸŠáŸ’ášá¶á„ áŸáŸ€áœá áŸ’áœá»á„", g:"F"},{id:"73", n:"á áŸá„ á˜áŸ‰á¸á¢áŸŠá·", g:"F"},{id:"74", n:"á¢á¿á“ á–áŸ…áœá›áŸá€áŸ’á", g:"F"},{id:"70", n:"ášáŸááŸ’á“ ášáŸ‰á¶ááŸá”", g:"M"}] },
            { className: "ááŸ’á“á¶á€áŸ‹á‘á¸ áŸ¢ (á€)", students: [{id:"21", n:"á…á“áŸ’áá¶ á›á¸áá¶", g:"F"},{id:"20", n:"á–áŸ… áŸá»áá…á·á“", g:"M"},{id:"17", n:"áá¶ášáŸ‰á¶ á áŸá„á›á¸", g:"M"},{id:"23", n:"áŸá»á áŸá˜áŸ’á”ááŸ’áá·", g:"M"},{id:"22", n:"áŸá»á áŠá¶á›á¸áŸ", g:"F"},{id:"29", n:"áŸáŸ’ášáŸáŸ‹ ášá¸á áŸ’áŸá¶", g:"F"},{id:"41", n:"á”áŸ‰á»á“ ášá¸á™áŸ‰á¶", g:"F"}] },
            { className: "ááŸ’á“á¶á€áŸ‹á‘á¸ áŸ¢ (á)", students: [{id:"59", n:"á¢á»á„ á”á‰áŸ’á‰á¶ášáŸááŸ’á“", g:"M"},{id:"31", n:"á˜á·ááŸ’á á˜áŸ‰áŸá„á á½áš", g:"M"},{id:"14", n:"á™áŸáŸ‹ á“ášá·á“áŸ’á‘", g:"M"},{id:"33", n:"áœá„áŸ‹ á–á»á‘áŸ’á’á·áá¶", g:"F"},{id:"62", n:"áŸá¼á™ á”á‰áŸ’á‰á¶", g:"M"},{id:"40", n:"áŸáŸá„ áŸá¶áá¶", g:"F"},{id:"39", n:"á…á“áŸ’á‘ áŸá»á•á¶á™áŸ‰á¶á˜áŸáƒ", g:"M"},{id:"30", n:"áŸáŸŠá“áœá¸ášáŸˆ á”á‰áŸ’á‰á¶á‘áŸá–á¸", g:"F"},{id:"27", n:"á”áŸŠá¼ áá¶á˜áŸ‰á¶", g:"M"},{id:"65", n:"á€áŸ‚áœ á˜á»á“áŸ’á“á¸á§ááŸ’áá˜", g:"M"},{id:"56", n:"áœá“áŸ’ááœá·á“ áá¶áá¶", g:"F"},{id:"36", n:"á á¶á“ áŸáŸŠá¸áœá áŸáš", g:"F"}] },
            { className: "ááŸ’á“á¶á€áŸ‹á‘á¸ áŸ£", students: [{id:"9", n:"á€áŸ‚áœ áœá¸á“áŸá»á§ááŸ’ááá¶ášá¶", g:"F"},{id:"28", n:"áˆá»á“áá¶ ášáá“áŸˆáá»á“áŠá¼", g:"F"},{id:"10", n:"á™áŸ‰á¶ á–áŸá‡áŸ’ášá˜áŸ‰á¼á“á¸á€á¶", g:"F"},{id:"15", n:"á›á¸á˜ á–á»á‘áŸ’á’á·ášá¶á‡", g:"M"},{id:"3", n:"á¡ áŸáŸŠá¸áœá áŸŠá½á™", g:"F"},{id:"2", n:"á¡á¶á™ á˜á»á“á·á…á·á“áŸ’áŠá¶", g:"F"},{id:"24", n:"á¢áŸ„á€ á“á·áŸá·áŸ’áŸá", g:"M"},{id:"44", n:"á…áŸ†ášá¾á“ á˜áŸ‰á¶á“á¸áá¶", g:"F"}] },
            { className: "ááŸ’á“á¶á€áŸ‹á‘á¸ áŸ¤-áŸ¥", students: [{id:"1", n:"á¡á¶á™ á—á¶ášáŸ‰á¶áŠá¶áœá¸áŒ", g:"M"},{id:"42", n:"áœá„áŸ’áŸ á˜á»á“á¸á€á‰áŸ’á…á“á¶", g:"F"},{id:"43", n:"á–áŸ… áŸá»á“á¸áá¶", g:"F"},{id:"4", n:"á¡ áŸá»áœááŸ’áá á¶á“áŸ‹áá¶", g:"F"}] },
            { className: "Foundation 1 (AM)", students: [{id:"-", n:"á†á¶á„ áŸáŸŠá¸á„á¢á¶á™", g:"F"},{id:"-", n:"áŸáŸŠá¸á˜ áŸá·á‘áŸ’á’á·á€á¶", g:"F"},{id:"82", n:"ášá»á“ ášáŸáŸ’á˜á¸", g:"M"},{id:"149", n:"á’á¸ áŸá»áœááŸ’á áŸá·á‘áŸ’á’á·á€á¶", g:"F"},{id:"143", n:"á•á“ áŸá»áá áŸ€á„", g:"M"},{id:"133", n:"áŸá»á‘áŸ’á’ á›á¸á“á”áŸ’ášá»áŸáŸá·á‘áŸ’á’", g:"M"},{id:"134", n:"á¢áŸŠá¶á” á›á¸á™á¸á„", g:"F"},{id:"88", n:"á…áŸ†ášá¾á“ á…á“áŸ’á‘á§ááŸ’áá˜", g:"M"},{id:"127", n:"á á˜ á…á¶á“áŸ‹á”á»ášá¸ášá€áŸ’áŸ", g:"M"},{id:"182", n:"áá¶áŸ†á„ á áŸŠá½á™á›á¸á“", g:"F"}] },
            { className: "Foundation 1 (PM)", students: [{id:"116", n:"á†á“ á˜áŸ‰áŸá„áŸáŸŠá¸á“", g:"M"},{id:"58", n:"á„á½á“ á‚á¸á˜á á¶á”áŸ‹", g:"M"},{id:"145", n:"á†á¶á™ á—á¸á„á¢áŸŠá¸á„", g:"F"},{id:"125", n:"á”á‰áŸ’á‰á¶ á—áŸááŸ’ášá¶", g:"F"},{id:"90", n:"á…áŸ†ášá¾á“ ášá¿á“ášá¹á‘áŸ’á’á·ášá¶á‡", g:"M"},{id:"159", n:"áá“ áŸáŸŠá¸á áŸ’á‚áŸ’áŸá·á…", g:"F"}] },
            { className: "Foundation 2 (A)", students: [{id:"86", n:"á’áŸá„ á˜áŸ‰áŸá„á›á¸", g:"M"},{id:"70", n:"ášáŸááŸ’á“ ášáŸ‰á¶ááŸá”", g:"M"}] },
            { className: "Foundation 2 (Narein)", students: [{id:"68", n:"áŸá»á„ ášá¹á‘áŸ’á’áŸáŸá€áŸ’á€", g:"M"},{id:"66", n:"á”áŸŠá»á“á¡áŸá„ á¢áŸŠáŸƒáŠá¹á€", g:"M"},{id:"67", n:"á—áŸ„á‚ áŸáŸ’á–á¸ááŒá¸", g:"M"}] },
            { className: "Level 1 (SreyNet)", students: [{id:"62", n:"áˆá¼á€ áˆá·á“á¡á»á„", g:"M"},{id:"64", n:"á›á¶á„ áœáŒáŸ’áƒá“á’á“á»", g:"M"}] },
            { className: "Level 2 (SreyNet)", students: [{id:"48", n:"áŸá»á—á€áŸ’áŠá· á‘á·ááŸ’ášáŠá¶áá¶", g:"F"},{id:"63", n:"á“á¿á“ áœáŒáŸ’áá“áŸ‡", g:"M"},{id:"49", n:"áŸá»á—á€áŸ’áŠá· ášáá“", g:"M"},{id:"61", n:"á•á› áŸá»áœááŸ’á", g:"M"},{id:"53", n:"á á»á„ áŸá·á‘áŸ’á’á·áá¶á›áŸ‹", g:"M"},{id:"55", n:"á’áŸá„ á‡á¼á›á¸á‰", g:"F"},{id:"1", n:"á¡á¶á™ á—á¶ášáŸ‰á¶áŠá¶áœá¸áŒ", g:"M"},{id:"4", n:"á¡ áŸá»áœááŸ’áá á¶á“áŸ‹áá¶", g:"F"}] }
        ];

        let currentIdx = -1;

        function init() {
            const list = document.getElementById('class-list');
            allData.forEach((c, i) => {
                const btn = document.createElement('button');
                btn.className = "text-left px-3 py-2 rounded text-[13px] font-semibold hover:bg-slate-50 transition-all flex justify-between";
                btn.innerHTML = `<span>${c.className}</span> <span class="text-slate-400 text-[10px]">${c.students.length}</span>`;
                btn.onclick = () => {
                    currentIdx = i;
                    document.querySelectorAll('#class-list button').forEach(b => b.classList.remove('active-class'));
                    btn.classList.add('active-class');
                    refreshTable();
                };
                list.appendChild(btn);
            });
        }

        function refreshTable() {
            if (currentIdx === -1) return;
            document.getElementById('empty-msg').style.display = 'none';
            const data = allData[currentIdx];
            const month = document.getElementById('sel-month').value;
            const year = document.getElementById('sel-year').value;
            document.getElementById('display-class-name').innerText = data.className;
            document.getElementById('display-date').innerText = `Attendance Period: ${month} ${year}`;
            
            const storageKey = `mikids_db_${data.className}_${month}_${year}`;
            const saved = JSON.parse(localStorage.getItem(storageKey)) || {};

            const tbody = document.getElementById('student-table-body');
            tbody.innerHTML = '';
            
            data.students.forEach((s, i) => {
                const status = saved[s.n] || 'P'; // Default is 'P' (Present)
                tbody.innerHTML += `
                    <tr class="hover:bg-slate-50 transition-colors">
                        <td class="p-4 text-center text-slate-400 font-mono text-[10px]">${i+1}</td>
                        <td class="p-4 font-bold text-blue-800 text-xs">${s.id}</td>
                        <td class="p-4 font-semibold text-slate-700">${s.n}</td>
                        <td class="p-4 text-center text-xs font-bold">${s.g}</td>
                        <td class="p-4">
                            <div class="flex justify-center gap-6">
                                <label class="flex items-center gap-1.5 cursor-pointer group">
                                    <input type="radio" name="s-${i}" value="P" ${status==='P'?'checked':''} class="radio-p w-4 h-4 accent-emerald-500"> 
                                    <span class="text-[11px] group-hover:text-emerald-500">á˜á€ (âœ…)</span>
                                </label>
                                <label class="flex items-center gap-1.5 cursor-pointer group">
                                    <input type="radio" name="s-${i}" value="L" ${status==='L'?'checked':''} class="radio-l w-4 h-4 accent-amber-500"> 
                                    <span class="text-[11px] group-hover:text-amber-500">á…áŸ’á”á¶á”áŸ‹ (P)</span>
                                </label>
                                <label class="flex items-center gap-1.5 cursor-pointer group">
                                    <input type="radio" name="s-${i}" value="A" ${status==='A'?'checked':''} class="radio-a w-4 h-4 accent-red-500"> 
                                    <span class="text-[11px] group-hover:text-red-500">áˆá”áŸ‹ (A)</span>
                                </label>
                            </div>
                        </td>
                    </tr>
                `;
            });
        }

        function saveLocal() {
            if (currentIdx === -1) return alert("Select a class!");
            const data = allData[currentIdx];
            const month = document.getElementById('sel-month').value;
            const year = document.getElementById('sel-year').value;
            const key = `mikids_db_${data.className}_${month}_${year}`;
            
            let obj = {};
            data.students.forEach((s, i) => {
                const radioValue = document.querySelector(`input[name="s-${i}"]:checked`).value;
                obj[s.n] = radioValue;
            });
            
            localStorage.setItem(key, JSON.stringify(obj));
            alert(`âœ… Recorded! ${data.className} for ${month} saved.`);
        }

        async function sendToTelegram() {
            if (currentIdx === -1) return alert("Select a class!");
            const token = document.getElementById('tg-token').value;
            const cid = document.getElementById('tg-id').value;
            const data = allData[currentIdx];
            const month = document.getElementById('sel-month').value;
            const year = document.getElementById('sel-year').value;

            let abs = [], lvs = [], pCount = 0;
            data.students.forEach((s, i) => {
                const val = document.querySelector(`input[name="s-${i}"]:checked`).value;
                if(val === 'P') pCount++;
                else if(val === 'L') lvs.push(s.n);
                else abs.push(s.n);
            });

            let msg = `ğŸ“Š *ATTENDANCE REPORT*\nğŸ« ááŸ’á“á¶á€áŸ‹áŸ– *${data.className}*\nğŸ“… ááŸ‚áŸ– *${month} ${year}*\n`;
            msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâœ… áœááŸ’áá˜á¶á“ (P)áŸ– ${pCount}\nğŸŸ  á…áŸ’á”á¶á”áŸ‹ (L)áŸ– ${lvs.length}\nğŸ”´ á¢áœááŸ’áá˜á¶á“ (A)áŸ– ${abs.length}\n`;
            
            if(abs.length > 0) msg += `\nâŒ *áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸá¢áœááŸ’áá˜á¶á“áŸ–*\n${abs.map((n, i) => (i+1)+'. '+n).join('\n')}`;
            if(lvs.length > 0) msg += `\n\nğŸ“ *áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸáŸá»áŸ†á…áŸ’á”á¶á”áŸ‹áŸ–*\n${lvs.map((n, i) => (i+1)+'. '+n).join('\n')}`;

            try {
                const res = await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({chat_id: cid, text: msg, parse_mode: 'Markdown'})
                });
                if(res.ok) alert("ğŸš€ Report sent successfully!");
                else alert("âŒ Error: Check your Token/Chat ID.");
            } catch (e) { alert("âŒ Connection failed."); }
        }

        init();
    </script>
</body>
</html>
