<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIKIDS Attendance System</title>
    <style>
        /* CSS ášá€áŸ’áŸá¶á‘á»á€áŠáŠáŸ‚á› á–áŸ’ášáŸ„áŸ‡áœá¶áŸáŸ’á¢á¶áá á¾á™ */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Khmer OS Siemreap', sans-serif; }
        body { background: #f0f2f5; padding: 15px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; flex-direction: column; height: 95vh; }
        .header { background: #4e73df; color: white; padding: 15px; text-align: center; border-radius: 12px 12px 0 0; }
        .main-content { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 320px; background: #f8f9fc; padding: 20px; border-right: 1px solid #e3e6f0; overflow-y: auto; }
        .section-title { font-weight: bold; color: #4e73df; margin: 15px 0 5px 0; border-bottom: 2px solid #e3e6f0; padding-bottom: 5px; }
        .date-input { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #d1d3e2; margin-bottom: 10px; }
        .class-list { display: flex; flex-direction: column; gap: 5px; }
        .class-item { padding: 10px; background: white; border: 1px solid #d1d3e2; border-radius: 5px; cursor: pointer; font-size: 14px; transition: 0.2s; position: relative; }
        .class-item:hover { background: #eaecf4; }
        .class-item.active { background: #4e73df; color: white; border-color: #4e73df; }
        .chat-status { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); font-size: 10px; }
        .chat-status.connected { color: #1cc88a; }
        .chat-status.not-connected { color: #e74a3b; }
        .chat-setup-section { margin-top: 15px; padding: 15px; background: white; border-radius: 8px; border: 1px solid #e3e6f0; }
        .input-group { margin-bottom: 10px; }
        .input-group label { display: block; font-size: 13px; margin-bottom: 5px; color: #5a5c69; font-weight: bold; }
        .input-group input { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #d1d3e2; font-size: 14px; }
        .btn-save { width: 100%; padding: 10px; background: #1cc88a; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 5px; }
        .content-area { flex: 1; padding: 20px; display: flex; flex-direction: column; overflow: hidden; }
        .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px; }
        .summary-box { text-align: center; padding: 10px; background: #f8f9fc; border-radius: 8px; border: 1px solid #e3e6f0; }
        .count { font-size: 20px; font-weight: bold; }
        .list-header { background: #f8f9fc; padding: 12px 15px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #e3e6f0; font-weight: bold; color: #5a5c69; }
        #studentContainer { flex: 1; overflow-y: auto; padding-right: 10px; }
        .student-card { display: flex; align-items: center; padding: 10px; background: #fff; border: 1px solid #e3e6f0; border-radius: 8px; margin-bottom: 8px; }
        .student-info { flex: 1; margin-left: 15px; }
        .student-name { font-weight: bold; font-size: 15px; color: #2e59d9; }
        .attendance-btns { display: flex; gap: 8px; }
        .btn-att { width: 45px; height: 45px; border: 1px solid #d1d3e2; border-radius: 8px; cursor: pointer; font-weight: bold; background: #f8f9fc; font-size: 16px; transition: 0.2s; }
        .btn-att.present.active { background: #1cc88a !important; color: white; border-color: #1cc88a; }
        .btn-att.permission.active { background: #f6c23e !important; color: white; border-color: #f6c23e; }
        .btn-att.absent.active { background: #e74a3b !important; color: white; border-color: #e74a3b; }
        .btn-main { padding: 12px 18px; border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 14px; }
        .bottom-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn-telegram { background: #0088cc; }
        .btn-excel { background: #28a745; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>MIKIDS Student Attendance Management System</h2>
        <div style="font-size: 12px; margin-top: 5px;">á”áŸ’ášá–áŸá“áŸ’á’á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„áœááŸ’áá˜á¶á“áŸá·áŸáŸ’áŸáá¶á˜ááŸ’á“á¶á€áŸ‹</div>
    </div>

    <div class="main-content">
        <div class="sidebar">
            <p class="section-title">á‡áŸ’ášá¾áŸášá¾áŸááŸ’á„áŸƒááŸ‚</p>
            <input type="date" id="attDate" class="date-input">
            
            <p class="section-title">á”á‰áŸ’á‡á¸ááŸ’á“á¶á€áŸ‹ášáŸ€á“</p>
            <div id="classList" class="class-list"></div>
            
            <div class="chat-setup-section">
                <p class="section-title">á€áŸ†áááŸ‹ Chat ID áŸá˜áŸ’ášá¶á”áŸ‹ááŸ’á“á¶á€áŸ‹</p>
                <div class="input-group">
                    <label>Telegram Chat ID:</label>
                    <input type="text" id="chatIdInput" placeholder="-100...">
                </div>
                <button class="btn-save" onclick="setChatIdForClass()">ğŸ’¾ ášá€áŸ’áŸá¶á‘á»á€ Chat ID</button>
                <button onclick="localStorage.removeItem('classChatIds'); location.reload();" style="width:100%; margin-top:5px; font-size:10px; color:gray; background:none; border:none; cursor:pointer;">âš ï¸ Reset All Chat IDs</button>
            </div>
        </div>

        <div class="content-area">
            <h3 id="displayClass" style="margin-bottom: 15px; color: #4e73df;">áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹</h3>
            
            <div class="summary-grid">
                <div class="summary-box"><div>áœááŸ’áá˜á¶á“ (âœ”ï¸)</div><div class="count" id="cP" style="color: #1cc88a;">0</div></div>
                <div class="summary-box"><div>á…áŸ’á”á¶á”áŸ‹ (P)</div><div class="count" id="cL" style="color: #f6c23e;">0</div></div>
                <div class="summary-box"><div>á¢áœááŸ’áá˜á¶á“ (A)</div><div class="count" id="cA" style="color: #e74a3b;">0</div></div>
                <div class="summary-box"><div>áŸášá»á”</div><div class="count" id="cT">0</div></div>
            </div>

            <div class="list-header">á”á‰áŸ’á‡á¸áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸ</div>
            <div id="studentContainer"></div>

            <div class="bottom-actions">
                <button class="btn-main btn-telegram" onclick="sendToTelegram()">ğŸ“¤ á•áŸ’á‰á¾á‘áŸ… Telegram</button>
                <button class="btn-main btn-excel" onclick="exportToExcel()">ğŸ“¥ ášá€áŸ’áŸá¶á‘á»á€á‡á¶ Excel</button>
            </div>
        </div>
    </div>
</div>

<script>
    // á”á‰áŸ’á‡á¸áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸ (á”á¶á“á€áŸ‚áˆáŸ’á˜áŸ„áŸ‡ááŸ’á“á¶á€áŸ‹á±áŸ’á™áŸáŸ’á¢á¶á)
    const studentData = {
        'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá˜á’áŸ’á™á˜(á–áŸ’ášá¹á€)': [
            { id: '64', name: 'áƒá»á“ á‘áŸá–á„áŸ’áŸ', sex: 'M' }, { id: '121', name: 'á“á¿á“ áœáŒáŸ’áá“á¶', sex: 'M' },
            { id: '128', name: 'á–á·áŸá·á‘áŸ’á¢ á…áŸá“áŸ’á‘áœáŒáŸ’áƒ', sex: 'M' }, { id: '141', name: 'á áŸá„ áŸá¶á‡á¸á„', sex: 'F' },
            { id: '132', name: 'áŸá» á”á‰áŸ’á‰á¶ á˜á»á“á·ášá¶á‡', sex: 'M' }, { id: '67', name: 'áˆá¿á“ á”áŸŠá»á“á’á¿á“á–á»á‘áŸ’á’á·', sex: 'M' },
            { id: '173', name: 'áŸá¶á“áŸ’á á›á¸á”áŸ‰áŸá„', sex: 'M' }, { id: '163', name: 'á¢áŸá„ á›á¸á†áŸá„', sex: 'M' },
            { id: '179', name: 'á…á“áŸ’áá¶ áœáŒáŸ’áá“á¶', sex: 'M' }, { id: '162', name: 'á™áŸ‰á¶á“áŸ‹ áŸá»áá¡áŸá„', sex: 'M' }
        ],
        'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá˜á’áŸ’á™á˜(ášáŸáŸ€á›)': [
            { id: '139', name: 'á áŸŠáºá˜ á˜áŸ‰á¸á¢áŸŠá·', sex: 'M' }, { id: '146', name: 'á›á“ áœáŸáŸáŸ’áŸá—á¼', sex: 'M' },
            { id: '102', name: 'áŸáŸ†áá¶á„ áœá¸ášáŸˆá”á»ááŸ’áš', sex: 'M' }, { id: '67', name: 'áˆá¿á“ á”áŸŠá»á“á’á¿á“á–á»á‘áŸ’á’á·', sex: 'M' },
            { id: '87', name: 'á¢áŸŠá»áŸ† ášáá“á¶áŸá·á‘áŸ’á’á¸á€á¶áš', sex: 'F' },{ id: '113', name: 'áŸáŸŠá¸á˜ áŸá·á‘áŸ’á’á¸á€á¶áš', sex: 'F' },
            { id: '164', name: 'á¢áŸŠá¼áŸá»áœááŸ’á áœáŸá á¶áŸ', sex: 'M' }, { id: '177', name: 'áá¶áŸ†á„ á áŸŠá½á™á›á¸á“', sex: 'F' }, 
            { id: '165', name: 'á›á¹á˜ á›á¸á˜áŸ‰áŸá„á‚áŸá„áŸ’á‚', sex: 'M' }
        ],
        'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹(á–áŸ’ášá¹á€)': [
            { id: '29', name: 'áá¶á“áŸ‹ á˜á»á“á¸áœá›áŸ’á›á—á¶', sex: 'F' }, { id: '101', name: 'áˆá»áŸ† áœá¸ášáŸ‹áŸá·á‘áŸ’á’', sex: 'M' },
            { id: '65', name: 'á“á·á áŸá»á’á¶ášáŸ‰á¶', sex: 'M' }, { id: '78', name: 'á“á¸ á›á¸á‡á¸á„', sex: 'F' },
            { id: '117', name: 'á áŸŠá»á“ ášá¶ááŸ’áá‡áŸááŸáŸ’áŠá¶', sex: 'M' }, { id: '47', name: 'á”á»ááŸ’áá‡áŸ á‡áŸá“á“á¸', sex: 'F' },
            { id: '14', name: 'áƒá»á“ á‘áŸá–á¸', sex: 'F' }, { id: '62', name: 'ášá·á‘áŸ’á’á¸ á–á·áŸáŸ’áŸá»ááŸá»á€áŸ’ášá¹á', sex: 'M' },
            { id: '49', name: 'á„á·á“ á‘áŸ€á“áœá·á“', sex: 'M' }, { id: '107', name: 'áŸá»á—á€áŸ’ášáŸ áœášáŸˆáŸá·á‘áŸ’á’', sex: 'M' },
            { id: '170', name: 'á¢á»á›áœá¿á“ áŠá¶áœá¸á“', sex: 'F' }, { id: '137', name: 'áŸá¿á“ á…á¶á“áŸ‹áŸá»á˜áŸá’á¶', sex: 'F' },
            { id: '1', name: 'á”áŸŠá»á“ášá¸á“ ááŸá˜ášá¶', sex: 'M' }
        ],
        'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹(ášáŸáŸ€á›)': [
            { id: '54', name: 'á™á“áŸ‹ á›á¸á áŸá„', sex: 'M' }, { id: '75', name: 'áœá·á“ á”á‰áŸ’á‰á¶áœáŸá“áŸ’á', sex: 'M' },
            { id: '90', name: 'áŸá¼ ášáŸáŸ’á˜á¸á–á“á·áá¶', sex: 'F' }, { id: '50', name: 'áŸá¼á™ ášá€áŸ’áŸá¶', sex: 'M' },
            { id: '0072', name: 'á¢áŸŠá¼ áŸá»áá¢á¶á˜á¸', sex: 'F' }, { id: '137', name: 'áŸá¿á“ á…á¶á“áŸ‹áŸá»á˜áŸá’á¶', sex: 'F' },
            { id: '176', name: 'á”áŸ‰á¹á˜ á˜áŸ‰á¸á‡á¼', sex: 'F' }, { id: '85', name: 'áŸáŸášá¸ á…á“áŸ’á‘áœáŒáŸ’áá“á¶', sex: 'M' },
            { id: '161', name: 'á›á¸á˜ á áŸŠá¸á”áŸ‰', sex: 'M' }, { id: '55', name: 'á¢áŸŠá¶ á‡á¸á„á áŸáš', sex: 'F' },
            { id: '0079', name: 'á˜á·ááŸ’á á˜áŸ‰áŸá„á áŸá„', sex: 'M' }, { id: '74', name: 'á…á¶á“áŸ‹á“á¸â€‹ áŸáŸŠá¼áŸá¶á“áŸ‹áá¶', sex: 'F' }
        ],
        'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¡(á–áŸ’ášá¹á€)': [
            { id: '75', name: 'á†á“ áœá·ášáŸˆáŸá·á‘áŸ’á’', sex: 'M' }, { id: '47', name: 'á‡á¶á¡á·á… á€á¼á›á¸á“', sex: 'M' },
            { id: '92', name: 'áŸá»á”á‰áŸ’á‰á¶ áŸáŸ„á˜áŸ‰á¶', sex: 'F' }, { id: '83', name: 'á—áºá“ áá·ášá¶á™á»', sex: 'M' },
            { id: '69', name: 'á›á¸ á†á¶á™áˆáŸá“', sex: 'M' }, { id: '77', name: 'áœá»áŒáŸ’áá¸ áŠá¶áœá¸á€á¶', sex: 'F' },
            { id: '93', name: 'á¢áŸŠá¹á˜ ášáŸ„á…á“á¶', sex: 'F' }, { id: '72', name: 'áœá„áŸ’áŸ áŠá¶ášáŸ‰á¶áœá¸á“', sex: 'M' },
            { id: '95', name: 'á…á¶áœ áœá·á“á á¶áœ', sex: 'M' }, { id: '80', name: 'á„á½á“ á”á‰áŸ’á‰á¶á–á»á‘áŸ’á’á·áŸáŸá€áŸ’áá·', sex: 'M' }
        ],
        'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¡(ášáŸáŸ€á›)': [
            { id: '88', name: 'á…áŸ†ášá¾á“ á…á“áŸ’á‘á§ááŸ’áá˜', sex: 'M' }, { id: '91', name: 'á”áŸŠá¼ áŸá¶á’á»á€á¶áš', sex: 'F' },
            { id: '82', name: 'áŸáŸá“ á™áŸ‰á¶áŸáŸ’á˜á¸á“áá¶', sex: 'F' }, { id: '85', name: 'áŠá“ áŸá»á—áŸááŸ’áŒá˜áŸ‰á¼á“á¸á€á¶', sex: 'F' },
            { id: '78', name: 'áŸáŸŠáŸ’ášá¶á„ áŸáŸ€áœá áŸ’áœá»á„', sex: 'F' }, { id: '73', name: 'á áŸá„ á˜áŸ‰á¸á¢áŸŠá·', sex: 'F' },
            { id: '74', name: 'á¢á¿á“ á–áŸ…áœá›áŸá€áŸ’á', sex: 'F' }, { id: '70', name: 'ášáŸááŸ’á“ ášáŸ‰á¶ááŸá”', sex: 'M' }
        ],
        'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¢(á–áŸ’ášá¹á€)': [
            { id: '21', name: 'á…á“áŸ’áá¶ á›á¸áá¶', sex: 'F' }, { id: '20', name: 'á–áŸ… áŸá»áá…á·á“', sex: 'M' },
            { id: '17', name: 'áá¶ášáŸ‰á¶ á áŸá„á›á¸', sex: 'M' }, { id: '23', name: 'áŸá»á áŸá˜áŸ’á”ááŸ’áá·', sex: 'M' },
            { id: '22', name: 'áŸá»á áŠá¶á›á¸áŸ', sex: 'F' }, { id: '29', name: 'áŸáŸ’ášáŸáŸ‹ ášá¸á áŸ’áŸá¶', sex: 'F' },
            { id: '41', name: 'á”áŸ‰á»á“ ášá¸á™áŸ‰á¶', sex: 'F' }
        ],
        'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¢(ášáŸáŸ€á›)': [
            { id: '59', name: 'á¢á»á„ á”á‰áŸ’á‰á¶ášáŸááŸ’á“', sex: 'M' }, { id: '31', name: 'á˜á·ááŸ’á á˜áŸ‰áŸá„á á½áš', sex: 'M' },
            { id: '14', name: 'á™áŸáŸ‹ á“ášá·á“áŸ’á‘', sex: 'M' }, { id: '33', name: 'áœá„áŸ‹ á–á»á‘áŸ’á’á·áá¶', sex: 'F' },
            { id: '62', name: 'áŸá¼á™ á”á‰áŸ’á‰á¶', sex: 'M' }, { id: '40', name: 'áŸáŸá„ áŸá¶áá¶', sex: 'F' },
            { id: '39', name: 'á…á“áŸ’á‘ áŸá»á•á¶á™áŸ‰á¶á˜áŸáƒ', sex: 'M' }, { id: '30', name: 'áŸáŸŠá“áœá¸ášáŸˆ á”á‰áŸ’á‰á¶á‘áŸá–á¸', sex: 'F' },
            { id: '27', name: 'á”áŸŠá¼ áá¶á˜áŸ‰á¶', sex: 'M' }, { id: '65', name: 'á€áŸ‚áœ á˜á»á“áŸ’á“á¸á§ááŸ’áá˜', sex: 'M' },
            { id: '56', name: 'áœá“áŸ’ááœá·á“ áá¶áá¶', sex: 'F' }, { id: '36', name: 'á á¶á“ áŸáŸŠá¸áœá áŸáš', sex: 'F' }
        ],
        'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ£(ášáŸáŸ€á›)': [
            { id: '9', name: 'á€áŸ‚áœ áœá¸á“áŸá»á§ááŸ’ááá¶ášá¶', sex: 'F' }, { id: '28', name: 'áˆá»á“áá¶ ášáá“áŸˆáá»á“áŠá¼', sex: 'F' },
            { id: '10', name: 'á™áŸ‰á¶ á–áŸá‡áŸ’ášá˜áŸ‰á¼á“á¸á€á¶', sex: 'F' }, { id: '15', name: 'á›á¸á˜ á–á»á‘áŸ’á’á·ášá¶á‡', sex: 'M' },
            { id: '3', name: 'á¡ áŸáŸŠá¸áœá áŸŠá½á™', sex: 'F' }, { id: '2', name: 'á¡á¶á™ á˜á»á“á·á…á·á“áŸ’áŠá¶', sex: 'F' },
            { id: '24', name: 'á¢áŸ„á€ á“á·áŸá·áŸ’áŸá', sex: 'M' }, { id: '44', name: 'á…áŸ†ášá¾á“ á˜áŸ‰á¶á“á¸áá¶', sex: 'F' }
        ],
        'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¤ ': [
            { id: '1', name: 'á¡á¶á™ á—á¶ášáŸ‰á¶áŠá¶áœá¸áŒ', sex: 'M' }, { id: '42', name: 'áœá„áŸ’áŸ á˜á»á“á¸á€á‰áŸ’á…á“á¶', sex: 'F' },
            { id: '43', name: 'á–áŸ… áŸá»á“á¸áá¶', sex: 'F' }, { id: '4', name: 'á¡ áŸá»áœááŸ’áá á¶á“áŸ‹áá¶', sex: 'F' }
        ],
        'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¥': [
            { id: '1', name: 'á¡á¶á™ á—á¶ášáŸ‰á¶áŠá¶áœá¸áŒ', sex: 'M' }, { id: '42', name: 'áœá„áŸ’áŸ á˜á»á“á¸á€á‰áŸ’á…á“á¶', sex: 'F' },
            { id: '43', name: 'á–áŸ… áŸá»á“á¸áá¶', sex: 'F' }, { id: '4', name: 'á¡ áŸá»áœááŸ’áá á¶á“áŸ‹áá¶', sex: 'F' }
        ],
        'Fount1 morning': [
            { id: '82', name: 'ášá»á“ ášáŸáŸ’á˜á¸', sex: 'M' }, { id: '149', name: 'á’á¸ áŸá»áœááŸ’á áŸá·á‘áŸ’á’á·á€á¶', sex: 'F' },
            { id: '143', name: 'á•á“ áŸá»áá áŸ€á„', sex: 'M' }, { id: '133', name: 'áŸá»á‘áŸ’á’ á›á¸á“á”áŸ’ášá»áŸáŸá·á‘áŸ’á’', sex: 'M' },
            { id: '134', name: 'á¢áŸŠá¶á” á›á¸á™á¸á„', sex: 'F' }, { id: '88', name: 'á…áŸ†ášá¾á“ á…á“áŸ’á‘á§ááŸ’áá˜', sex: 'M' },
            { id: '127', name: 'á á˜ á…á¶á“áŸ‹á”á»ášá¸ášá€áŸ’áŸ', sex: 'M' }, { id: '182', name: 'áá¶áŸ†á„ á áŸŠá½á™á›á¸á“', sex: 'F' }
        ],
        'Fount1 Evening': [
            { id: '116', name: 'á†á“ á˜áŸ‰áŸá„áŸáŸŠá¸á“', sex: 'M' }, { id: '58', name: 'á„á½á“ á‚á¸á˜á á¶á”áŸ‹', sex: 'M' },
            { id: '145', name: 'á†á¶á™ á—á¸á„á¢áŸŠá¸á„', sex: 'F' }, { id: '125', name: 'á”á‰áŸ’á‰á¶ á—áŸááŸ’ášá¶', sex: 'F' },
            { id: '90', name: 'á…áŸ†ášá¾á“ ášá¿á“ášá¹á‘áŸ’á’á·ášá¶á‡', sex: 'M' }, { id: '159', name: 'áá“ áŸáŸŠá¸á áŸ’á‚áŸ’áŸá·á…', sex: 'F' }
        ],
        'Nursery(á–áŸ’ášá¹á€)': [
            { id: '148', name: 'á”áŸášáŸ‰áŸáŸ á˜áŸ‰áŸƒáƒá¾áŸ', sex: 'M' }, { id: '144', name: 'á áŸá„ áŸá“áŸ’áá·á—á¶á–', sex: 'M' },
            { id: '157', name: 'áŠá½á„ áŸá»á˜áŸá’á¶', sex: 'M' }, { id: '183', name: 'áá»á„ á áŸ’áœá»á„á˜áŸ‰áŸá„', sex: 'M' },
            { id: '158', name: 'á–á“áŸ’á›á€ áœá·ášáŸá·á‘áŸ’á’', sex: 'M' }, { id: '172', name: 'ášáá“á¶ áŸáŸ€áœá›á·', sex: 'F' },
            { id: '180', name: 'ášáŸ‰á¶ááŸ‹ á–áŸá‡áŸ’ášá˜ášá€á', sex: 'F' }, { id: '178', name: 'á›á¸áœá‘áŸ’á’á¸ á‡á»áá·á˜á¶', sex: 'F' },
            { id: '184', name: 'á á¼ á›á¸á—á¸á„', sex: 'M' }, { id: '174', name: 'áœá·á…áŸ’á†á·á€á¶ á˜á»á“áŸ’á“á¸á‘áŸá–á¸', sex: 'F' },
            { id: '185', name: 'á™á¹á˜ á–á»á‘áŸ’á’á·áœá„áŸ’áŸ', sex: 'M' }, { id: '171', name: 'áŸá»á„ áŸá·ášá¸á”á»ááŸ’áš', sex: 'M' }
        ],
        'Nursery(ášáŸáŸ€á›)': [
            { id: '148', name: 'á”áŸášáŸ‰áŸáŸ á˜áŸ‰áŸƒáƒá¾áŸ', sex: 'M' },
            { id: '147', name: 'áŸá»á—áŸá€áŸ’áš áœá¸ášá”á»ááŸ’áš', sex: 'M' }, { id: '150', name: 'áœáŸ‰áŸá á“á¸ášá¸áá¶', sex: 'F' },
            { id: '166', name: 'á›á¸áá¶ á á»á„áŸáŸá€áŸ’á€á·á¢á’á·á—á¼', sex: 'M' }
        ],
        'Fount2': [
            { id: '86', name: 'á’áŸá„ á˜áŸ‰áŸá„á›á¸', sex: 'M' }, { id: '00', name: 'áŸáŸŠáŸ’ášá¶á„ áŸáŸ€áœá áŸ’áœá»á„', sex: 'F' },
            { id: '00', name: 'á áŸá„ á˜áŸ‰á¸á¢áŸŠá·', sex: 'F' }, { id: '00', name: 'á¢á¿á“ á–áŸ…áœá›áŸá€áŸ’á', sex: 'F' },
            { id: '00', name: 'á á¶á“ áŸáŸŠá¸áœá áŸáš', sex: 'F' }, { id: '00', name: 'ášáŸááŸ’á“ áŸá»áœááŸ’áá…áŸá“áŸ’á‘áá¶á€á¶', sex: 'M' },
            { id: '00', name: 'á…áŸ†ášá¾á“ á˜áŸ‰á¶á“á¸áá¶ ', sex: 'F' }, { id: '70', name: 'ášáŸááŸ’á“ ášáŸ‰á¶ááŸá”', sex: 'M' }
        ],
        'Fount2(narein)': [
            { id: '68', name: 'áŸá»á„ ášá¹á‘áŸ’á’áŸáŸá€áŸ’á€', sex: 'M' }, { id: '00', name: 'á–áŸ… áŸá»áá…á·á“', sex: 'M' },
            { id: '66', name: 'á”áŸŠá»á“á¡áŸá„ á¢áŸŠáŸƒáŠá¹á€', sex: 'M' }, { id: '67', name: 'á—áŸ„á‚ áŸáŸ’á–á¸ááŒá¸', sex: 'M' },
            { id: '00', name: 'á¢áŸŠá¹á˜ ášáŸ„á…á“á¶', sex: 'F' }, { id: '00', name: 'á„á½á“ á”á‰áŸ’á‰á¶á–á»á‘áŸ’á’á·áŸáŸá€áŸ’áá·', sex: 'M' },
            { id: '00', name: 'á‡á¶á¡á·á… á€á¼á›á¸á“', sex: 'M' }, { id: '00', name: 'áá¶ášáŸ‰á¶ á áŸá„á›á¸', sex: 'M' },
            { id: '00', name: 'á†á“ áœá·ášáŸˆáŸá·á‘áŸ’á’', sex: 'M' }, { id: '00', name: 'áŸá»á áŸá˜áŸ’á”ááŸ’áá·', sex: 'M' },
            { id: '00', name: 'áŸá»á áŠá¶á›á¸áŸ', sex: 'F' }, { id: '00', name: 'á…á¶áœ áœá·á“á á¶áœ', sex: 'M' },
            { id: '00', name: 'á›á¸ á†á¶á™áˆáŸá“á”', sex: 'M' }
        ],
        'Level1': [
            { id: '00', name: 'á¢áŸ„á€ á§ááŸ’áá˜', sex: 'M' }, { id: '00', name: 'áá¶ášáŸ‰á¶ á áŸá„á¡á¶á™', sex: 'M' },
            { id: '62', name: 'áˆá¼á€ áˆá·á“á¡á»á„', sex: 'M' }, { id: '00', name: 'á–áŸ… áŸá»á“á¸áá¶', sex: 'F' },
            { id: '00', name: 'á€áŸ‚áœ áœá¸á“áŸá»á§ááŸ’ááá¶ášá¶', sex: 'F' }, { id: '00', name: 'áˆá»á“áá¶ ášáá“áŸˆáá»á“áŠá¼', sex: 'F' },
            { id: '64', name: 'á›á¶á„ áœáŒáŸ’áƒá“á’á“á»', sex: 'M' }, { id: '00', name: 'á™áŸ‰á¶ á–áŸá‡áŸ’ášá˜áŸ‰á¼á“á¸á€á¶', sex: 'F' },
            { id: '00', name: 'á›á¸á˜ á–á»á‘áŸ’á’á·ášá¶á‡', sex: 'M' }, { id: '00', name: 'á¡ áŸáŸŠá¸áœá áŸŠá½á™', sex: 'F' },
            { id: '00', name: 'á¡á¶á™ á˜á»á“á·á…á·á“áŸ’áŠá¶', sex: 'F' }, { id: '00', name: 'á¢áŸ„á€ á“á·áŸá·áŸ’áŸá', sex: 'M' },
            { id: '00', name: 'á…á“áŸ’á‘ áŸá»á•á¶á™áŸ‰á¶á˜áŸáƒ', sex: 'M' }, { id: '00', name: 'áŸáŸŠá“áœá¸ášáŸˆ á”á‰áŸ’á‰á¶á‘áŸá–á¸', sex: 'F' }
        ],
        'Level2': [
            { id: '48', name: 'áŸá»á—á€áŸ’áŠá· á‘á·ááŸ’ášáŠá¶áá¶', sex: 'F' }, { id: '63', name: 'á“á¿á“ áœáŒáŸ’áá“áŸ‡', sex: 'M' },
            { id: '49', name: 'áŸá»á—á€áŸ’áŠá· ášáá“', sex: 'M' }, { id: '61', name: 'á•á›â€‹ áŸá»áœááŸ’á', sex: 'M' },
            { id: '53', name: 'á á»á„ áŸá·á‘áŸ’á’á·áá¶á›áŸ‹', sex: 'M' }, { id: '55', name: 'á’áŸá„ á‡á¼á›á¸á‰', sex: 'F' },
            { id: '1', name: 'á¡á¶á™ á—á¶ášáŸ‰á¶áŠá¶áœá¸áŒ', sex: 'M' }, { id: '4', name: 'á¡ áŸá»áœááŸ’áá á¶á“áŸ‹áá¶', sex: 'F' }
        ],
        'á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá‘á¶á”(á–áŸ’ášá¹á€)': [
            { id: '147', name: 'áŸá»á—á€áŸ’áš áœá¸ášá”á»ááŸ’áš', sex: 'M' }, { id: '166', name: 'á›á¸áá¶ ášáŸááŸ’á“á á»á„áŸáŸá€áŸ’á€á·á¢á’á·á—á¼', sex: 'M' },
            { id: '160', name: 'áá¼ áŸá·á‘áŸ’á’á¸á™á¼áá¶', sex: 'F' }, { id: '175', name: 'áŸá»á‚á“áŸ’á’ á”á‰áŸ’á‰á¶áŸáŸá€', sex: 'M' },
            { id: '000', name: 'áŸá»á¸á˜ áŸášá§ááŸ’áá˜', sex: 'M' },{ id: '000' , name: 'á“á·á áŸá»á’á¶ášá¶á‡',  sex:'M'},
            { id: '000', name: 'áœáŸ‰áŸá á“á¸ášá¸áá¶', sex: 'F' }
        ],
        'á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá‘á¶á”(ášáŸáŸ€á›)':[
            { id: '175', name: 'á áŸá„ á‡áŸášá˜á»á¸á„', sex: 'F' }, { id: '000', name: 'áŸá¶á™ áŸá»áá áŸá„', sex: 'M' },
            { id: '181', name: 'áˆá“ á…áŸáŸáŸ’áŠá¶', sex: 'M' }, { id: '000', name: 'á›á¶á„ á›á€áŸ’áŸá»á·á€á‰áŸ’á…á“á¶', sex: 'M' },
            { id: '177', name: 'áœá¶áŸá“á¶ á–áŸá‡áŸ’ášáŸá»á˜áŸ‰á¶á›á¸', sex: 'F' }
        ]
    };

    const TELEGRAM_BOT_TOKEN = '8501623225:AAGu-F_GHSQ-dLBrEME7eidOpW2yDf3qvXw'; 
    let classChatIds = JSON.parse(localStorage.getItem('classChatIds')) || {};
    let selectedClassName = '';

    window.onload = () => {
        document.getElementById('attDate').valueAsDate = new Date();
        
        // á”á‰áŸ’á‡á¸ Chat ID á›áŸ†á“á¶áŸ†áŠá¾á˜ (ááŸ’ášá¼áœá”áŸ’ášá¶á€áŠáá¶áˆáŸ’á˜áŸ„áŸ‡ááŸ’á“á¶á€áŸ‹ áŠá¼á…á‚áŸ’á“á¶áŸ¡áŸ áŸ % á‡á¶á˜á½á™ studentData)
        const defaultIds = {
            'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá˜á’áŸ’á™á˜(á–áŸ’ášá¹á€)': '-4845440768',
            'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá˜á’áŸ’á™á˜(ášáŸáŸ€á›)': '-4845440768',
            'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹(á–áŸ’ášá¹á€)': '-4828804361',
            'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹(ášáŸáŸ€á›)': '-4828804361',
            'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¡(á–áŸ’ášá¹á€)': '-4936041559',
            'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¡(ášáŸáŸ€á›)': '-4936041559',
            'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¢(á–áŸ’ášá¹á€)': '-4953929888',
            'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¢(ášáŸáŸ€á›)': '-4953929888',
            'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ£(ášáŸáŸ€á›)': '-4872387682',
            'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¤ ': '-4844052526',
            'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¥': '-4712921883',
            'Fount1 morning': '-4986675448',
            'Fount1 Evening': '-4986675448',
            'Nursery(á–áŸ’ášá¹á€)': '-4924159874',
            'Nursery(ášáŸáŸ€á›)': '-4924159874',
            'Fount2': '-4871212513',
            'Fount2(narein)': '-4871212513',
            'Level1': '-4906276801',
            'Level2': '-4968404918',
            'á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá‘á¶á”(á–áŸ’ášá¹á€)': '-4835279036',
            'á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá‘á¶á”(ášáŸáŸ€á›)': '-4835279036'
        };

        // áŠá¶á€áŸ‹áá˜áŸ’á›áŸƒ default á…á¼á› á”áŸ’ášáŸá·á“á”á¾á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á€áŸ’á“á»á„ localStorage
        Object.keys(defaultIds).forEach(key => {
            if (!classChatIds[key]) classChatIds[key] = defaultIds[key];
        });

        initClassList();
        
        // á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹áŠáŸ†á”á¼á„
        const firstClass = Object.keys(studentData)[0];
        if(firstClass) {
            selectClass(null, firstClass);
        }
    };

    function initClassList() {
        const classListDiv = document.getElementById('classList');
        classListDiv.innerHTML = "";
        
        Object.keys(studentData).forEach((className) => {
            const div = document.createElement('div');
            div.className = 'class-item';
            if (className === selectedClassName) div.classList.add('active');
            
            const hasChatId = classChatIds[className] && classChatIds[className].trim() !== '';
            const statusIcon = hasChatId ? 
                '<span class="chat-status connected">â—</span>' : 
                '<span class="chat-status not-connected">â—</span>';
            
            div.innerHTML = className + statusIcon;
            div.onclick = () => selectClass(div, className);
            classListDiv.appendChild(div);
        });
    }

    function selectClass(element, className) {
        document.querySelectorAll('.class-item').forEach(i => i.classList.remove('active'));
        if(element) {
            element.classList.add('active');
        } else {
            // á”á¾á‚áŸ’á˜á¶á“ element (á áŸ…á–á¸ onload) ááŸ’ášá¼áœášá€áœá¶á±áŸ’á™áƒá¾á‰
            const items = document.querySelectorAll('.class-item');
            items.forEach(it => { if(it.innerText.includes(className)) it.classList.add('active'); });
        }
        
        selectedClassName = className;
        document.getElementById('displayClass').innerText = "á”á‰áŸ’á‡á¸áˆáŸ’á˜áŸ„áŸ‡ - " + className;
        
        const currentChatId = classChatIds[className] || '';
        document.getElementById('chatIdInput').value = currentChatId;
        
        renderStudents(className);
    }

    function setChatIdForClass() {
        let chatId = document.getElementById('chatIdInput').value.trim();
        if (!selectedClassName) return alert('âš ï¸ áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹!');
        if (!chatId) return alert('âš ï¸ áŸá¼á˜á”á‰áŸ’á…á¼á› Chat ID!');
        
        classChatIds[selectedClassName] = chatId;
        localStorage.setItem('classChatIds', JSON.stringify(classChatIds));
        alert(`âœ… ášá€áŸ’áŸá¶á‘á»á€ Chat ID áŸá˜áŸ’ášá¶á”áŸ‹ ${selectedClassName} ášá½á…ášá¶á›áŸ‹!`);
        initClassList();
    }

    function renderStudents(className) {
        const container = document.getElementById('studentContainer');
        container.innerHTML = "";
        const students = studentData[className] || [];
        
        students.forEach(s => {
            const card = document.createElement('div');
            card.className = 'student-card';
            card.setAttribute('data-name', s.name);
            card.setAttribute('data-id', s.id);
            card.innerHTML = `
                <div style="font-weight:bold; color:#4e73df; width:40px;">${s.id}</div>
                <div class="student-info">
                    <div class="student-name">${s.name}</div>
                    <div style="font-size:12px; color:#858796;">á—áŸá‘: ${s.sex === 'M' ? 'á”áŸ’ášá»áŸ' : 'áŸáŸ’ášá¸'}</div>
                </div>
                <div class="attendance-btns">
                    <button class="btn-att present" onclick="mark(this, 'âœ”ï¸')">âœ”ï¸</button>
                    <button class="btn-att permission" onclick="mark(this, 'P')">P</button>
                    <button class="btn-att absent" onclick="mark(this, 'A')">A</button>
                </div>
            `;
            container.appendChild(card);
        });
        calculateSummary();
    }

    function mark(btn, type) {
        const parent = btn.parentElement;
        parent.querySelectorAll('.btn-att').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        calculateSummary();
    }

   function calculateSummary() {
    const permissionCount = document.querySelectorAll('.btn-att.permission.active').length;
    const absentCount = document.querySelectorAll('.btn-att.absent.active').length;
    const totalStudents = document.querySelectorAll('.student-card').length;
    const presentCount = totalStudents - (permissionCount + absentCount);
    
    // âœ… UPDATE UI á“áŸ…á‘á¸á“áŸáŸ‡
    document.getElementById('cP').innerText = presentCount;
    document.getElementById('cL').innerText = permissionCount;
    document.getElementById('cA').innerText = absentCount;
    document.getElementById('cT').innerText = totalStudents;
}

    async function sendToTelegram() {
    if (!selectedClassName) return alert("âš ï¸ áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹!");
    
    const chatId = classChatIds[selectedClassName] ? classChatIds[selectedClassName].trim() : null;
    if (!chatId) return alert("âš ï¸ á˜á·á“á‘á¶á“áŸ‹á˜á¶á“ Chat ID áŸá˜áŸ’ášá¶á”áŸ‹ááŸ’á“á¶á€áŸ‹á“áŸáŸ‡!");

    const date = document.getElementById('attDate').value;
    const allCards = document.querySelectorAll('.student-card');
    
    const permissionCount = document.querySelectorAll('.btn-att.permission.active').length;
    const absentCount = document.querySelectorAll('.btn-att.absent.active').length;
    const totalAbsent = permissionCount + absentCount;
    
    // á”áŸ’áá¼ášá˜á€á”áŸ’ášá¾ HTML Tags áœá·á‰áŠá¾á˜áŸ’á”á¸á—á¶á–á…áŸ’á”á¶áŸáŸ‹á›á¶áŸáŸ‹
    let message = `<b>ğŸ“Š ášá”á¶á™á€á¶ášááŸáœááŸ’áá˜á¶á“</b>\n`;
    message += `ğŸ« ááŸ’á“á¶á€áŸ‹: <b>${selectedClassName}</b>\n`;
    message += `ğŸ“… ááŸ’á„áŸƒá‘á¸: ${date}\n`;
    message += `--------------------------\n`;
    
    let hasIssue = false;
    allCards.forEach((card) => {
        const isP = card.querySelector('.btn-att.permission').classList.contains('active');
        const isA = card.querySelector('.btn-att.absent').classList.contains('active');
        if (isP || isA) {
            hasIssue = true;
            const name = card.getAttribute('data-name');
            const id = card.getAttribute('data-id');
            message += `ğŸ†” ${id}. ${name} -> ${isP ? 'ğŸŸ¡ á…áŸ’á”á¶á”áŸ‹' : 'ğŸ”´ á¢áœááŸ’áá˜á¶á“'}\n`;
        }
    });

    if (!hasIssue) message += "âœ… áŸá·áŸáŸ’áŸáœááŸ’áá˜á¶á“á‚áŸ’ášá”áŸ‹á…áŸ†á“á½á“\n";
    
    message += `--------------------------\n`;
    message += `âŒ á¢áœááŸ’áá˜á¶á“áŸášá»á”: <b>${totalAbsent}</b> á“á¶á€áŸ‹\n`;
    message += `   ğŸŸ¡ á…áŸ’á”á¶á”áŸ‹: ${permissionCount} á“á¶á€áŸ‹\n`;
    message += `   ğŸ”´ á¥áá…áŸ’á”á¶á”áŸ‹: ${absentCount} á“á¶á€áŸ‹`;

    try {
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                chat_id: chatId, 
                text: message, 
                parse_mode: 'HTML' // á€áŸ‚á–á¸ Markdown á˜á€ HTML
            })
        });
        const result = await response.json();
        if (response.ok) {
            alert("âœ… á”á¶á“á•áŸ’á‰á¾á‘áŸ… Telegram ášá½á…ášá¶á›áŸ‹!");
        } else {
            alert(`âŒ á”ášá¶á‡áŸá™! ${result.description}`);
        }
    } catch (e) { 
        alert("âŒ á”á‰áŸ’á á¶á”á…áŸ’á…áŸá€á‘áŸáŸ! áŸá¼á˜á–á·á“á·ááŸ’á™á¢áŸŠá¸á“á’áºáá·ááŸ”");
    }
}
</script>

</body>
</html>

